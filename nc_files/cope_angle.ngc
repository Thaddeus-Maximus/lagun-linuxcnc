o<cope_angle> sub
	; o<cope_angle> call <0|2> <x> <y1><y2> <angle> <zstart><zend> <fincut> <mode>
	; o<cope_angle> call <1|3> <y> <x1><x2> <angle> <zstart><zend> <fincut> <mode>

	; 0: +x side
	; 1: +y side
	; 2: -x side
	; 3: -y side

	;G10 L0 ; re-read tool data
	G90	  ; absolute x,y,z
	G91.1 ; incremental i,j,k
	M101  ; enable Z-axis (M102 disables)
	G17   ; select XY plane for arcs

	#<M_CONVENTIONAL> = [FIX[#9/1] MOD 2 EQ 1]
	#<M_BOTHWAYS>     = [FIX[#9/2] MOD 2 EQ 1]
	#<M_PLUNGE>       = [FIX[#9/4] MOD 2 EQ 1]
	#<M_OUTSIDE>      = [FIX[#9/8] MOD 2 EQ 1]
	#<M_CLIMB>        = [FIX[#9/1] MOD 2 EQ 0]
	#<M_ONEWAY>       = [FIX[#9/2] MOD 2 EQ 0]
	#<M_HELIX>        = [FIX[#9/4] MOD 2 EQ 0]
	#<M_INSIDE>       = [FIX[#9/8] MOD 2 EQ 0]


	#<td> = #5410
	#<tr> = [#<td>/2]
	o1 if [EXISTS[#<_z_clearance>]]
		#<z_clearance> = #<_z_clearance>
	o1 else
		#<z_clearance> = #5
	o1 endif
	o3 if [EXISTS[#<_stepover>]]
		#<stepover> = #<_stepover>
	o3 else
		#<stepover> = [#<td>*0.4]
	o3 endif

	#<c> = #3
	#<b> = #4
	o4 if [#4 LT #3]
		#<c> = #4
		#<b> = #3
	o4 endif

	; this works for one-way conventional, direction 0

	G0 Z#<z_clearance>

	#<l_total> = [[#<b>-#<c>]*SIN[#5]]

	#<l_steps> = FUP[[#<l_total>-#8]/#<stepover>]

	G0 X#2 Y[#<b>]

	o100 while [#<l_steps> GE 0]
		#<dl> = [#<l_total> - [#<l_steps>*#<stepover>+#8]]

		G0 X[#2 + #<tr>*COS[#5]] Y[#<b> - #<dl>/SIN[#5] - #<tr>*COS[#5]/TAN[#5]]
		G1 X[#2 - #<dl>/COS[#5] - #<tr>*SIN[#5]*TAN[#5]] Y[#<b> + #<tr>*SIN[#5]]

		#<dl> = [#<l_total> - [#<l_steps>*#<stepover>+#8+#<stepover>*0.2]]
		G0 X[#2 - #<dl>/COS[#5] - #<tr>*SIN[#5]*TAN[#5]] Y[#<b> + #<tr>*SIN[#5]]
		G0 X[#2 + #<tr>*COS[#5]] Y[#<b> - #<dl>/SIN[#5] - #<tr>*COS[#5]/TAN[#5]]

		#<l_steps> = [#<l_steps>-1]
	o100 endwhile


	G0 X[#2 + #<tr>*COS[#5]] Y[#<b> - #<l_total>/SIN[#5] - #<tr>*COS[#5]/TAN[#5]]
	G1 X[#2 - #<l_total>/COS[#5] - #<tr>*SIN[#5]*TAN[#5]] Y[#<b> + #<tr>*SIN[#5]]


	

o<cope_angle> endsub

M2